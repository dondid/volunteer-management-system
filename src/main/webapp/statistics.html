<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistics Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fa; }
        .stat-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: transform 0.2s;
            overflow: hidden;
        }
        .stat-card:hover { transform: translateY(-5px); }
        .icon-box {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .bg-gradient-primary { background: linear-gradient(45deg, #4e73df, #224abe); }
        .bg-gradient-success { background: linear-gradient(45deg, #1cc88a, #13855c); }
        .bg-gradient-info { background: linear-gradient(45deg, #36b9cc, #258391); }
        .bg-gradient-warning { background: linear-gradient(45deg, #f6c23e, #dda20a); }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="index.html"><i class="bi bi-arrow-left"></i> Back to Home</a>
            <span class="navbar-text text-white fw-bold">Real-time Statistics</span>
        </div>
    </nav>

    <div class="container">
        <div id="loading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>

        <div id="dashboard" style="display: none;">
            <!-- Overview Cards -->
            <div class="row g-4 mb-5">
                <div class="col-md-3">
                    <div class="stat-card p-4">
                        <div class="icon-box bg-gradient-primary text-white">
                            <i class="bi bi-people"></i>
                        </div>
                        <h3 class="fw-bold" id="totalVolunteers">0</h3>
                        <p class="text-muted mb-0">Total Volunteers</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card p-4">
                        <div class="icon-box bg-gradient-success text-white">
                            <i class="bi bi-building"></i>
                        </div>
                        <h3 class="fw-bold" id="totalOrganizations">0</h3>
                        <p class="text-muted mb-0">Organizations</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card p-4">
                        <div class="icon-box bg-gradient-info text-white">
                            <i class="bi bi-kanban"></i>
                        </div>
                        <h3 class="fw-bold" id="totalProjects">0</h3>
                        <p class="text-muted mb-0">Active Projects</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card p-4">
                        <div class="icon-box bg-gradient-warning text-white">
                            <i class="bi bi-calendar-event"></i>
                        </div>
                        <h3 class="fw-bold" id="totalEvents">0</h3>
                        <p class="text-muted mb-0">Upcoming Events</p>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="row g-4">
                <div class="col-md-8">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white py-3">
                            <h5 class="mb-0">Entity Distribution</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="distributionChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white py-3">
                            <h5 class="mb-0">System Status</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Assignments
                                    <span class="badge bg-primary rounded-pill" id="totalAssignments">0</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Certificates
                                    <span class="badge bg-success rounded-pill" id="totalCertificates">0</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Skills
                                    <span class="badge bg-info rounded-pill" id="totalSkills">0</span>
                                </li>
                            </ul>
                            <div class="mt-4 text-center">
                                <p class="text-muted small">Data fetched from:</p>
                                <code class="bg-light p-2 rounded">/api/statistics/overview</code>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="error" class="alert alert-danger mt-4" style="display: none;">
            Error fetching data. Ensure the API server is running.
        </div>
    </div>

    <script>
        fetch('api/statistics/overview')
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            })
            .then(json => {
                const data = json.data;
                // Update specific IDs
                document.getElementById('totalVolunteers').innerText = data.totalVolunteers;
                document.getElementById('totalOrganizations').innerText = data.totalOrganizations;
                document.getElementById('totalProjects').innerText = data.totalProjects;
                document.getElementById('totalEvents').innerText = data.totalEvents;
                document.getElementById('totalAssignments').innerText = data.totalAssignments;
                document.getElementById('totalCertificates').innerText = data.totalCertificates;
                document.getElementById('totalSkills').innerText = data.totalSkills;

                // Create Chart
                const ctx = document.getElementById('distributionChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Volunteers', 'Orgs', 'Projects', 'Events', 'Assignments'],
                        datasets: [{
                            label: 'Total Count',
                            data: [
                                data.totalVolunteers, 
                                data.totalOrganizations, 
                                data.totalProjects, 
                                data.totalEvents,
                                data.totalAssignments
                            ],
                            backgroundColor: [
                                '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });

                // Show dashboard
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
            })
            .catch(error => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                console.error('Error:', error);
            });
    </script>
</body>
</html>
